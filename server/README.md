# MAX Efficiency - Backend Server

Backend —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è MAX Efficiency, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ Node.js, Express –∏ PostgreSQL.

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ REST API —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ MAX –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ (CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏)
- –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –°–∏—Å—Ç–µ–º—É —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js** 20.x - Runtime –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- **Express** 4.x - Web framework
- **PostgreSQL** 16.x - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **TypeScript** 5.x - –¢–∏–ø–∏–∑–∞—Ü–∏—è
- **JWT** - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Helmet** - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **CORS** - Cross-Origin Resource Sharing

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ß–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
docker-compose up backend
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
npm run migrate:dev

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –°–±–æ—Ä–∫–∞ –¥–ª—è production
npm run build

# –ó–∞–ø—É—Å–∫ production –≤–µ—Ä—Å–∏–∏
npm start
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://user:password@localhost:5432/maxflow

# –°–µ—Ä–≤–µ—Ä
PORT=3000
NODE_ENV=development

# JWT
JWT_SECRET=your-secret-key-change-in-production

# CORS
CORS_ORIGIN=http://localhost:5173
```

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π (development)
npm run migrate:dev

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π (production)
npm run migrate
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

#### users
- `id` - UUID, –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `max_user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ MAX
- `phone` - –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### tasks
- `id` - UUID, –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `user_id` - –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ users
- `title` - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `description` - –û–ø–∏—Å–∞–Ω–∏–µ
- `status` - –°—Ç–∞—Ç—É—Å (pending, in_progress, completed)
- `priority` - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (low, medium, high)
- `due_date` - –î–µ–¥–ª–∞–π–Ω
- `completed_at` - –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### challenges
- `id` - UUID, –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `user_id` - –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ users
- `type` - –¢–∏–ø —á–µ–ª–ª–µ–Ω–¥–∂–∞
- `target` - –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `current` - –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `status` - –°—Ç–∞—Ç—É—Å
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## üîå API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

#### POST /api/auth/max
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ MAX –ø–ª–∞—Ç—Ñ–æ—Ä–º—É

**Request:**
```json
{
  "initData": "string"
}
```

**Response:**
```json
{
  "token": "jwt_token",
  "user": {
    "id": "uuid",
    "maxUserId": "string",
    "phone": "string"
  }
}
```

### –ó–∞–¥–∞—á–∏

#### GET /api/tasks
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Query params:**
- `status` - –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `priority` - –§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
- `date` - –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ

**Response:**
```json
[
  {
    "id": "uuid",
    "title": "string",
    "description": "string",
    "status": "pending",
    "priority": "high",
    "dueDate": "2024-01-01",
    "completedAt": null,
    "createdAt": "2024-01-01T00:00:00Z"
  }
]
```

#### POST /api/tasks
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É

**Request:**
```json
{
  "title": "string",
  "description": "string",
  "priority": "high",
  "dueDate": "2024-01-01"
}
```

#### PUT /api/tasks/:id
–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É

**Request:**
```json
{
  "title": "string",
  "status": "completed",
  "priority": "medium"
}
```

#### DELETE /api/tasks/:id
–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏

#### GET /api/business/stats
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**Response:**
```json
{
  "totalTasks": 100,
  "completedTasks": 75,
  "completionRate": 0.75,
  "averageCompletionTime": 3600000
}
```

### –ß–µ–ª–ª–µ–Ω–¥–∂–∏

#### GET /api/challenges
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π

#### POST /api/challenges
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂

#### PUT /api/challenges/:id
–û–±–Ω–æ–≤–∏—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏

#### GET /api/settings
–ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### PUT /api/settings
–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Helmet** - –ó–∞—â–∏—Ç–∞ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- **CORS** - –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
- **JWT** - –¢–æ–∫–µ–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Rate limiting** - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å)

## üß™ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
server/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.ts   # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ env.ts        # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ controllers/      # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasksController.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ businessController.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ challengesController.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settingsController.ts
‚îÇ   ‚îú‚îÄ‚îÄ middleware/       # Middleware
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.ts       # –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT
‚îÇ   ‚îú‚îÄ‚îÄ routes/           # –ú–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ business.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ challenges.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.ts
‚îÇ   ‚îú‚îÄ‚îÄ migrations/       # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 001_create_users_table.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 002_create_app_tables.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 003_add_completed_at_to_tasks.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 004_convert_task_ids_to_uuid.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ run.ts
‚îÇ   ‚îú‚îÄ‚îÄ types/            # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ utils/            # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ maxAuth.ts
‚îÇ   ‚îî‚îÄ‚îÄ index.ts          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
```

### –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å hot-reload
npm run dev

# –°–±–æ—Ä–∫–∞
npm run build

# –ó–∞–ø—É—Å–∫ production
npm start

# –ú–∏–≥—Ä–∞—Ü–∏–∏ (dev)
npm run migrate:dev

# –ú–∏–≥—Ä–∞—Ü–∏–∏ (prod)
npm run migrate
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç console.log –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –í production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å winston –∏–ª–∏ pino.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

```bash
# –ß–µ—Ä–µ–∑ Docker
docker-compose exec postgres psql -U maxflow -d maxflow

# –õ–æ–∫–∞–ª—å–Ω–æ
psql -U maxflow -d maxflow
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
SELECT * FROM migrations;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü
\dt
\d users
\d tasks
```
